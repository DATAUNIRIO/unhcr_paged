<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width">
<meta property="og:title" content="How to quickly produce statistical reports?" />




<meta name="author" content="The UNHCR “R-Cookbook”" />


<meta name="description" content="How to quickly produce statistical reports?">

<title>How to quickly produce statistical reports?</title>


<script src="index_files/paged-0.2.4/js/config.js"></script>
<script src="index_files/paged-0.2.4/js/paged.js"></script>
<script src="index_files/paged-0.2.4/js/hooks.js"></script>




<link rel="stylesheet" href="css/unhcr.css" type="text/css" />
<link rel="stylesheet" href="css/unhcr-page.css" type="text/css" />
<link rel="stylesheet" href="css/unhcr-fonts.css" type="text/css" />

</head>

<body>

<div class="running-h1-title"></div>

<div class="running-h2-title"></div>



<div class="front-page">
<div id="header" class="title-page">
<h1 class="title">How to quickly produce statistical reports?</h1>
<h2 class="author">The UNHCR “<em>R-Cookbook</em>”</h2>
<h2 class="date">Version: 2019-04-08</h2>
</div>
</div>

<div class="front-matter-container">
<div id="TOC" class="level1 toc front-matter">
<ul>
<li><a href="#graphics-with-style"><span class="toc-section-number">1</span> Graphics with “<em>style</em>”</a><ul>
<li><a href="#a-report-or-a-dashbaord"><span class="toc-section-number">1.1</span> A report or a dashbaord?</a></li>
<li><a href="#importance-of-reproducibility"><span class="toc-section-number">1.2</span> Importance of reproducibility</a></li>
<li><a href="#chart-to-convey-stories"><span class="toc-section-number">1.3</span> Chart to convey “<em>stories</em>”</a></li>
</ul></li>
<li><a href="#set-up-your-environment"><span class="toc-section-number">2</span> Set up your environment</a><ul>
<li><a href="#software-libraries"><span class="toc-section-number">2.1</span> Software &amp; Libraries</a></li>
<li><a href="#report-template"><span class="toc-section-number">2.2</span> Report template</a></li>
<li><a href="#prepare-some-data"><span class="toc-section-number">2.3</span> Prepare some data</a></li>
</ul></li>
<li><a href="#generate-different-kind-of-plots"><span class="toc-section-number">3</span> Generate different kind of plots</a><ul>
<li><a href="#line-chart"><span class="toc-section-number">3.1</span> Line chart</a></li>
<li><a href="#multiple-line-chart"><span class="toc-section-number">3.2</span> Multiple line chart</a></li>
<li><a href="#bar-chart"><span class="toc-section-number">3.3</span> Bar chart</a></li>
<li><a href="#stacked-bar-chart"><span class="toc-section-number">3.4</span> Stacked bar chart</a></li>
<li><a href="#grouped-bar-chart"><span class="toc-section-number">3.5</span> Grouped bar chart</a></li>
<li><a href="#dumbbell-chart"><span class="toc-section-number">3.6</span> Dumbbell chart</a></li>
<li><a href="#histogram"><span class="toc-section-number">3.7</span> Histogram</a></li>
<li><a href="#scatterplot"><span class="toc-section-number">3.8</span> Scatterplot</a></li>
<li><a href="#maps"><span class="toc-section-number">3.9</span> Maps</a></li>
</ul></li>
<li><a href="#work-with-small-multiples"><span class="toc-section-number">4</span> Work with small multiples</a><ul>
<li><a href="#facets"><span class="toc-section-number">4.1</span> Facets</a></li>
<li><a href="#free-scales"><span class="toc-section-number">4.2</span> Free scales</a></li>
</ul></li>
<li><a href="#make-changes-to-the-legend"><span class="toc-section-number">5</span> Make changes to the legend</a><ul>
<li><a href="#remove-the-legend"><span class="toc-section-number">5.1</span> Remove the legend</a></li>
<li><a href="#change-the-position-of-the-legend"><span class="toc-section-number">5.2</span> Change the position of the legend</a></li>
<li><a href="#remove-the-legend-title"><span class="toc-section-number">5.3</span> Remove the legend title</a></li>
<li><a href="#reverse-the-order-of-your-legend"><span class="toc-section-number">5.4</span> Reverse the order of your legend</a></li>
<li><a href="#rearrange-the-layout-of-your-legend"><span class="toc-section-number">5.5</span> Rearrange the layout of your legend</a></li>
<li><a href="#change-the-appearance-of-your-legend-symbols"><span class="toc-section-number">5.6</span> Change the appearance of your legend symbols</a></li>
<li><a href="#add-space-between-your-legend-labels"><span class="toc-section-number">5.7</span> Add space between your legend labels</a></li>
</ul></li>
<li><a href="#make-changes-to-the-axes"><span class="toc-section-number">6</span> Make changes to the axes</a><ul>
<li><a href="#addremove-gridlines"><span class="toc-section-number">6.1</span> Add/remove gridlines</a></li>
<li><a href="#change-the-axis-text-manually"><span class="toc-section-number">6.2</span> Change the axis text manually</a></li>
<li><a href="#add-thousand-separators-to-your-axis-labels"><span class="toc-section-number">6.3</span> Add thousand separators to your axis labels</a></li>
<li><a href="#add-text-to-your-axis-labels"><span class="toc-section-number">6.4</span> Add text to your axis labels</a></li>
<li><a href="#change-the-plot-limits"><span class="toc-section-number">6.5</span> Change the plot limits</a></li>
<li><a href="#add-axis-titles"><span class="toc-section-number">6.6</span> Add axis titles</a></li>
<li><a href="#modify-axis-titles"><span class="toc-section-number">6.7</span> Modify axis titles</a></li>
<li><a href="#add-axis-ticks"><span class="toc-section-number">6.8</span> Add axis ticks</a></li>
</ul></li>
<li><a href="#add-annotations"><span class="toc-section-number">7</span> Add annotations</a><ul>
<li><a href="#insert-text-within-chart"><span class="toc-section-number">7.1</span> Insert text within chart</a></li>
<li><a href="#left-alignright-align-text"><span class="toc-section-number">7.2</span> Left-align/right-align text</a></li>
<li><a href="#add-labels-based-on-your-data"><span class="toc-section-number">7.3</span> Add labels based on your data</a></li>
<li><a href="#add-left-aligned-labels-to-bar-charts"><span class="toc-section-number">7.4</span> Add left-aligned labels to bar charts</a></li>
<li><a href="#add-a-line"><span class="toc-section-number">7.5</span> Add a line</a></li>
<li><a href="#add-a-curved-line"><span class="toc-section-number">7.6</span> Add a curved line</a></li>
<li><a href="#add-an-arrow"><span class="toc-section-number">7.7</span> Add an arrow</a></li>
<li><a href="#add-a-line-across-the-whole-plot"><span class="toc-section-number">7.8</span> Add a line across the whole plot</a></li>
</ul></li>
<li><a href="#do-something-else-entirely"><span class="toc-section-number">8</span> Do something else entirely</a><ul>
<li><a href="#increase-or-decrease-margins"><span class="toc-section-number">8.1</span> Increase or decrease margins</a></li>
<li><a href="#exporting-your-plot-and-x-axis-margins"><span class="toc-section-number">8.2</span> Exporting your plot and x-axis margins</a></li>
<li><a href="#reorder-bars-manually"><span class="toc-section-number">8.3</span> Reorder bars manually</a></li>
<li><a href="#colour-bars-conditionally"><span class="toc-section-number">8.4</span> Colour bars conditionally</a></li>
</ul></li>
<li><a href="#conclusion"><span class="toc-section-number">9</span> Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>
</div>

<p>The cookbook aims as well at making it easier for people new to R to create graphics. It implements a specific theme (using <code>ggplot2</code> R library) and report template (using <code>pagedown</code> R library).</p>
<p>All the code below is ready to be copy pasted. This report template itself, as it comes with UNHCR branding style, can also easily be re-used.</p>
<p>The cookbook covers basic use cases. When dealing complex survey data set, based on a population sample where data must be weighted, we are advising to use the dedicated package <a href="https://unhcr.github.io/koboloadeR/docs/">KoboloadeR</a>.</p>
<p>This document has been largely inspired by the <a href="https://bbc.github.io/rcookbook/">BBC cookbook</a>.</p>
<div id="graphics-with-style" class="section level1">
<h1><span class="header-section-number">1</span> Graphics with “<em>style</em>”</h1>
<div id="a-report-or-a-dashbaord" class="section level2">
<h2><span class="header-section-number">1.1</span> A report or a dashbaord?</h2>
<p>Often analysts start building a dashboard when dealing with a new dataset. This is a correct approach only under certain conditions.</p>
<p>A dashboard is a one-screen group of summary visualizations that facilitate rapid assessment of a system (the best example for this being a car dashboard when the driver can monitor speed, heat, fuel, etc.). It displays the most important information needed to achieve one ore more objectives, consolidated and arranged in a format so that the information can be monitored at a glance. A report, by contrast, is an ordered presentation of a detailed data set. Reports are usually longer and more detailed, although they may have summary components.</p>
<p>In short, dashboards tend to focus on Key Performance Indicators (KPIs), while reports tend to focus on underlying data. Dashboards communicate specific points, while reports are aiming at telling a story. Statistical reports are therefore the starting point for any data analysis: this is the format to use to develop narrative interpretation for existing data in order to <strong>develop knowledge</strong>. It’s only once the knowledge and interpretation keys on a specific data set is developped that end-users will be able to make sense of a dashboard presenting the same kind of data.</p>
</div>
<div id="importance-of-reproducibility" class="section level2">
<h2><span class="header-section-number">1.2</span> Importance of reproducibility</h2>
<p>Reproducibility is key in data analysis:</p>
<ul>
<li><p>It can save a lot of time when very similar analysis has to be done in different operations or points in time,</p></li>
<li><p>It allows for quickly scanning the analysis workflow and point potential errors,</p></li>
<li><p>It allows for peer review and/or can help peers to learn from what is presented. Openness and transparency improve trust in results.</p></li>
</ul>
<p>The entry point to analysis reproducibility is to have each step documented through scripts, rather than using <em>point and click</em> graphical user interface. R is a very powerful language for this:</p>
<ol style="list-style-type: decimal">
<li><p>It’s open source (i.e. it can be customized to accommodate specific needs) and free to use (i.e. not only saving financial resources for core humanitarian activities but also avoiding there long and cumbersome software procurement processes);</p></li>
<li><p>It is now an industry-standard in data science and data mining (for instance it is now integrated per default in recent versions of Microsoft SQL Server);</p></li>
<li><p>It has a strong community, which leverages package (i.e. logic &amp; workflow) development and plenty of tutorial material and user group;</p></li>
<li><p>It covers the entire analysis workflow: from data import, data tidying, data reshaping, visualization with chart, modeling and generation of report to communicate results.</p></li>
</ol>
<div class="figure">
<img src="data-science.png" alt="Diagram: Data Science Workflow" />
<p class="caption"><strong>Diagram:</strong> Data Science Workflow</p>
</div>
<p>This cookbook does not aim at replacing the numerous books available on data science, like the <a href="https://r4ds.had.co.nz">R for Data Science</a>, it is rather a quick reference to be used by colleagues that aims at building skills in the area.</p>
<p>In November 2018, the first HumanitaRian-useR-group took place. An online <a href="https://join.skype.com/qYBKC5q3wKp4">skype group</a>, with over 150 members at the time of writing is openly accessible and tutorial based on humanitarian situations are published on a <a href="http://humanitarian-user-group.github.io/">blog</a>.</p>
</div>
<div id="chart-to-convey-stories" class="section level2">
<h2><span class="header-section-number">1.3</span> Chart to convey “<em>stories</em>”</h2>
<p>Effective chart are first those that <strong>support a message</strong>. From the same data set a multiplicity of chart can be produced. The best chart is the one that present in the most powerful way the message that you want to pass-on and the story you want to tell.</p>
<p>Simple rules can help achieving this:</p>
<ul>
<li><p><strong>Outline the message</strong>: Always use the main conclusion you want to draw within the title of the chart, use the subtitle to present the data that you have used in the chart. annotation in the chart can also help explaining why the chart is an evidence of the message you present. The message resides in the shape of the data. Chart titles should be clear and accurate, includes time increment and units.</p></li>
<li><p><strong>Do keep the chart as simple as possible</strong>. Edward Tufte, a statistician, said “<em>Graphical elegance is often found in simplicity of design and complexity of data.</em>” A common mistake we all make with charts is overdressing them with unnecessary elements. The usual suspects are excess color, graphical clutter and abuse of special effects. Details like these won’t impress anyone but de-cluttering your charts will.</p></li>
<li><p><strong>Focus on legibility</strong>: Graph should be designed to highlight trends, patterns and make exceptions more visible. They can also be designed to reveal relationships among multiple values. For instance, for bar graph presenting categories, do use a horizontal bar graph and arrange data from greatest to least in descending order.</p></li>
<li><p><strong>Use color to communicate information and not for decoration</strong>. Too many colors can confuse and disorient. When designing a graph, color can be both your friend and your enemy. Depending on how we use it, it can either gracefully highlight data and show changes, or create visual overload and confuse the audience. Don’t use more than six colors or six different categories within the same chart: human brain cannot process more than this.</p></li>
<li><p><strong>Reshape first your data</strong>: A good chart establish a balance between content &amp; message: Too many content -&gt; not legible; Not enough content -&gt; not precise. Therefore, the content (i.e. the data) shall be adjusted content to message. For instance, extra decimal places look impressive and imply accuracy, but they’re often pointless. So, take a step back and round numbers off before plotting. Overstating the numerical precision of your data by showing too many decimal places can make your chart seem accurate, but this specificity is just misleading. Even when you don’t exaggerate the precision of your data, and your numbers are genuinely accurate, overloading your audience with such detail is often useless</p></li>
</ul>
<p>By using this cookbook, you can benefit from a simple and lean style and focus on your data, message and story-telling, rather than wasting precious time on chart beautification and report design.</p>
</div>
</div>
<div id="set-up-your-environment" class="section level1">
<h1><span class="header-section-number">2</span> Set up your environment</h1>
<p>We’ll get to how you can put together the various elements of these graphics, but <strong>let’s get the admin out of the way first…</strong></p>
<div id="software-libraries" class="section level2">
<h2><span class="header-section-number">2.1</span> Software &amp; Libraries</h2>
<p>You will need to first install <a href="https://www.r-project.org/">R</a> and <a href="https://www.rstudio.com/products/rstudio/download/">R sudio</a>. The next step could be to download this repository and re-run the Rmd file line by line and see the results of each instructions to familiarize yourself with the code.</p>
<p>A few of the steps in this cookbook - and to create charts in R in general - require certain packages to be installed and loaded. So that you do not have to install and load them one by one, you can use the <code>using</code> function to load them all at once with the following code.</p>
<pre class="r"><code>## Getting all necessary package
using &lt;- function(...) {
    libs &lt;- unlist(list(...))
    req &lt;- unlist(lapply(libs,require,character.only = TRUE))
    need &lt;- libs[req == FALSE]
    if (length(need) &gt; 0) { 
        install.packages(need)
        lapply(need,require,character.only = TRUE)
    }
}
using(&#39;tidyverse&#39;,&#39;gganimate&#39;,&#39;gghighlight&#39;,&#39;ggpubr&#39;, &#39;dplyr&#39;, &#39;tidyr&#39;, &#39;gapminder&#39;, &#39;ggplot2&#39;,  &#39;ggalt&#39;, &#39;forcats&#39;, &#39;R.utils&#39;, &#39;png&#39;, &#39;grid&#39;, &#39;ggpubr&#39;, &#39;scales&#39;, &#39;bbplot&#39;, &#39;markdown&#39;, &#39;pander&#39;, &#39;ISOcodes&#39;, &#39;wbstats&#39;, &#39;sf&#39;, &#39;rnaturalearth&#39;, &#39;rnaturalearthdata&#39;, &#39;ggspatial&#39;)</code></pre>
<p>All graphics in the cookbook are created with the library <code>ggplot2</code>. Without going into too much details, the main concept behind this package is called the <strong>grammar of graphics</strong>. It’s a very powerful abstraction to describe any kind of plots using a limited number of instructions.</p>
<p>The idea is that you can build every graph from the same few components: a data set (<strong>data</strong>), a set of geometry (<strong>geom</strong> : visual marks that represents data points: bar, line, point, area, polygon, etc.) and a coordinate system (<strong>coord</strong>). To display data values, variables in the data set shall be mapped to aesthetic properties of the geom (<strong>aes</strong>: like size, color and x and y locations). In addition, some plots visualize a transformation of the original variable that is described by the instruction <strong>stat</strong>.</p>
<p>Using scripts can appear difficult at the beginning but with a bit of practice, it provides huge gain of productivity compared to point and click interactions.</p>
<p>UNHCR style is delivered through the function: <code>unhcr_style()</code>. This function essentially modifies certain arguments in the <code>theme</code> function of <code>ggplot2</code>.</p>
<pre class="r"><code>unhcr_style &lt;- function() {
  font &lt;- &quot;Lato&quot;
  ggplot2::theme(
    
#This sets the font, size, type and colour of text for the chart&#39;s title
  plot.title = ggplot2::element_text(family=font, size=20, face = &quot;bold&quot;, color = &quot;#222222&quot;),

#This sets the font, size, type and colour of text for the chart&#39;s subtitle,  as well as setting a margin between the title and the subtitle
  plot.subtitle = ggplot2::element_text(family=font, size=16, margin=ggplot2::margin(9,0,9,0)),
  plot.caption = ggplot2::element_blank(),

#This sets the position and alignment of the legend, removes a title and backround for it and sets the requirements for any text within the legend. The legend may often need some more manual tweaking when it comes to its exact position based on the plot coordinates.
  legend.position = &quot;top&quot;,
  legend.text.align = 0,
  legend.background = ggplot2::element_blank(),
  legend.title = ggplot2::element_blank(),
  legend.key = ggplot2::element_blank(),
  legend.text = ggplot2::element_text(family=font, size=13, color = &quot;#222222&quot;),

#This sets the text font, size and colour for the axis test, as well as setting the margins and removes lines and ticks. In some cases, axis lines and axis ticks are things we would want to have in the chart
  axis.title = ggplot2::element_blank(),
  axis.text = ggplot2::element_text(family=font, size=13, color = &quot;#222222&quot;),
  axis.text.x = ggplot2::element_text(margin=ggplot2::margin(5, b = 10)),
  axis.ticks = ggplot2::element_blank(),
  axis.line = ggplot2::element_blank(),

#This removes all minor gridlines and adds major y gridlines. In many cases you will want to change this to remove y gridlines and add x gridlines. 
  panel.grid.minor = ggplot2::element_blank(),
  panel.grid.major.y = ggplot2::element_line(color = &quot;#cbcbcb&quot;),
  panel.grid.major.x = ggplot2::element_blank(),

#This sets the panel background as blank, removing the standard grey ggplot background colour from the plot
  panel.background = ggplot2::element_blank(),

#This sets the panel background for facet-wrapped plots to white, removing the standard grey ggplot background colour and sets the title size of the facet-wrap title to font size 22
  strip.background = ggplot2::element_rect(fill = &quot;white&quot;),
  strip.text = ggplot2::element_text(size  = 13,  hjust = 0)
  )
}</code></pre>
<p><code>unhcr_style()</code>: has no arguments and is added to the ggplot ‘chain’ after you have created a plot. What it does is generally makes text size, font and color, axis lines, axis text, margins and many other standard chart components into UNHCR style, which has been formulated based on recommendations and feedback from the design team.</p>
<p>Note that colors for lines in the case of a line chart or bars for a bar chart, do not come out of the box from the <code>unhcr_style()</code> function, but need to be explicitly set in your other standard <code>ggplot</code> chart functions.</p>
<p>You can modify these settings for your chart, or add additional theme arguments, by calling the <code>theme</code> function with the arguments you want - but please note that for it to work you must call it <em>after</em> you have called the <code>unhcr_style</code> function. Otherwise <code>unhcr_style()</code> will override it.</p>
<p>The following for instance will add some grid lines, by adding extra theme arguments to what is included in the <code>unhcr_style()</code> function. There are many similar examples throughout the cookbook.</p>
<pre class="r"><code>theme(panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
        panel.grid.major.y = element_blank())</code></pre>
<p>A specific statement is used to align the chart, it’s title, subtitle and source</p>
<p><code>ggpubr::ggarrange(left_align(line, c(&quot;subtitle&quot;, &quot;title&quot;)), ncol = 1, nrow = 1)</code></p>
<p>It use a specific function <code>left_align()</code>:</p>
<pre class="r"><code>#Left align text
left_align &lt;- function(plot_name, pieces){
  grob &lt;- ggplot2::ggplotGrob(plot_name)
  n &lt;- length(pieces)
  grob$layout$l[grob$layout$name %in% pieces] &lt;- 2
  return(grob)
}</code></pre>
<p>Another function, <code>format_si()</code>, can be also installed to format numbers on axis.</p>
<pre class="r"><code>## a little help function to better format numbers
format_si &lt;- function(...) {
  function(x) {
    limits &lt;- c(1e-24, 1e-21, 1e-18, 1e-15, 1e-12,
                1e-9,  1e-6,  1e-3,  1e0,   1e3,
                1e6,   1e9,   1e12,  1e15,  1e18,
                1e21,  1e24)
    prefix &lt;- c(&quot;y&quot;,   &quot;z&quot;,   &quot;a&quot;,   &quot;f&quot;,   &quot;p&quot;,
                &quot;n&quot;,   &quot;&quot;,   &quot;m&quot;,   &quot; &quot;,   &quot;k&quot;,
                &quot;M&quot;,   &quot;G&quot;,   &quot;T&quot;,   &quot;P&quot;,   &quot;E&quot;,
                &quot;Z&quot;,   &quot;Y&quot;)

    # Vector with array indices according to position in intervals
    i &lt;- findInterval(abs(x), limits)

    # Set prefix to &quot; &quot; for very small values &lt; 1e-24
    i &lt;- ifelse(i == 0, which(limits == 1e0), i)

    paste(format(round(x/limits[i], 1),
                 trim = TRUE, scientific = FALSE, ...),
          prefix[i])
  }
}</code></pre>
</div>
<div id="report-template" class="section level2">
<h2><span class="header-section-number">2.2</span> Report template</h2>
<p>Markdown is a simple formatting language designed to make authoring content easy for everyone. Rather than write in complex markup code (e.g. HTML or LaTex), you write in plain text with formatting cues.</p>
<p><a href="https://rmarkdown.rstudio.com/">R Markdown</a> allows to weave together narrative text and code to produce elegantly formatted output. Within an R Markdown file, R Code Chunks can be embedded with the native Markdown syntax for fenced code regions.</p>
<p>An R Markdown document can be then rendered into the final output format (for instance HTML, but also directly into word or PDF). R Markdown documents contains a metadata section that includes title, author, and date information as well as options for customizing output.</p>
<p><a href="https://github.com/rstudio/pagedown">Pagedown</a> is a package that allows to transform an R Markdown file into an htlm files, directly paginated (with CSS for Print) to be saved as PDF. With Pagedown, you only need a modern web browser (e.g., Google Chrome) to generate PDF.</p>
<p>This package requires a recent version of Pandoc (&gt;= 2.2.3). If you use RStudio, you are recommended to install the Preview version (&gt;= 1.2.1070), which has bundled Pandoc 2.x, otherwise you need to install Pandoc separately.</p>
<p>This template demonstrates some of the basic <span class="proglang">markdown</span> you’ll need to know to create a UNHCR Statistical report <strong>pagedown</strong> <span class="citation">[@R-pagedown]</span>.</p>
<p>If you use the option <code>self_contained: false</code> (see line #22 of this <code>Rmd</code> file), don’t click on the <code>Knit</code> button in RStudio. Use instead the <strong>xaringan</strong> <span class="citation">[@R-xaringan]</span> RStudio add-in <em>Infinite Moon Reader</em>.</p>
</div>
<div id="prepare-some-data" class="section level2">
<h2><span class="header-section-number">2.3</span> Prepare some data</h2>
<p>This cookbook is based on real UNHCR data.</p>
<p>Last Let’s now download (&amp; slightly tidy) data from UNHCR popstat API together with indicators from the World Bank and some geodata.</p>
<pre class="r"><code># Time series
url &lt;- paste( &#39;http://popstats.unhcr.org/en/time_series.csv&#39;) 
download.file(url, destfile = &quot;unhcr_popstats_export_time_series_all_data.csv&quot; )
time_series &lt;- read.csv(&quot;unhcr_popstats_export_time_series_all_data.csv&quot;, skip = 3) 

## Rename the country and
names(time_series)[2] &lt;- &quot;Country&quot;

## Make sure Value is numeric
time_series$Value &lt;- as.integer(as.character(time_series$Value))

## Check what population type we have there and subset accordingly
#levels(time_series$Population.type)
time_series2 &lt;- time_series[ time_series$Population.type %in% c(&quot;Refugees (incl. refugee-like situations)&quot;, &quot;Internally displaced persons&quot; ), ]
## Re create levels for filtered Population.type
time_series$Population.type &lt;- as.factor(as.character(time_series$Population.type))

## Get region name
url &lt;- paste( &#39;https://pkgstore.datahub.io/core/country-codes/country-codes_csv/data/3b9fd39bdadd7edd7f7dcee708f47e1b/country-codes_csv.csv&#39;) 
download.file(url, destfile = &quot;countrycode.csv&quot; )
countrycode &lt;- read.csv(&quot;countrycode.csv&quot;) 
#names(countrycode)

### Rewrite country name in UNHCR dataset for further matching
time_series$ctryiso &lt;- as.character(time_series$Country)
time_series$ctryiso[time_series$Country == &quot;Bonaire&quot;] &lt;- &quot;Bonaire, Sint Eustatius and Saba&quot; 
time_series$ctryiso[time_series$Country == &quot;Central African Rep.&quot;] &lt;- &quot;Central African Republic&quot; 
time_series$ctryiso[time_series$Country == &quot;China, Hong Kong SAR&quot;] &lt;- &quot;China, Hong Kong Special Administrative Region&quot; 
time_series$ctryiso[time_series$Country == &quot;China, Macao SAR&quot;] &lt;- &quot;China, Macao Special Administrative Region&quot;  
time_series$ctryiso[time_series$Country == &quot;C\xf4te d&#39;Ivoire&quot;] &lt;- &quot;Côte d&#39;Ivoire&quot; 
time_series$ctryiso[time_series$Country == &quot;Cura\xe7ao&quot;] &lt;- &quot;Curaçao&quot; 
time_series$ctryiso[time_series$Country == &quot;Czech Rep.&quot;] &lt;- &quot;Czechia&quot; 
time_series$ctryiso[time_series$Country == &quot;Dem. Rep. of the Congo&quot;] &lt;- &quot;Democratic Republic of the Congo&quot; 
time_series$ctryiso[time_series$Country == &quot;Dominican Rep.&quot;] &lt;- &quot;Dominican Republic&quot; 
time_series$ctryiso[time_series$Country == &quot;Iran (Islamic Rep. of)&quot;] &lt;- &quot;Iran (Islamic Republic of)&quot; 
time_series$ctryiso[time_series$Country == &quot;Lao People&#39;s Dem. Rep.&quot;] &lt;- &quot;Lao People&#39;s Democratic Republic&quot; 
time_series$ctryiso[time_series$Country == &quot;Rep. of Korea&quot;] &lt;- &quot;Republic of Korea&quot; 
time_series$ctryiso[time_series$Country == &quot;Dem. People&#39;s Rep. of Korea&quot;] &lt;- &quot;Democratic People&#39;s Republic of Korea&quot; 
time_series$ctryiso[time_series$Country == &quot;Rep. of Moldova&quot;] &lt;- &quot;Republic of Moldova&quot;  
time_series$ctryiso[time_series$Country == &quot;Serbia and Kosovo (S/RES/1244 (1999))&quot;] &lt;- &quot;Serbia&quot; 
time_series$ctryiso[time_series$Country == &quot;Syrian Arab Rep.&quot;] &lt;- &quot;Syrian Arab Republic&quot; 
time_series$ctryiso[time_series$Country == &quot;United Rep. of Tanzania&quot;] &lt;- &quot;United Republic of Tanzania&quot; 
time_series$ctryiso[time_series$Country == &quot;Holy See (the)&quot;] &lt;- &quot;Holy See (Vatican City State)&quot; 
time_series$ctryiso[time_series$Country == &quot;Réunion&quot;] &lt;- &quot;Reunion&quot; 
time_series$ctryiso[time_series$Country == &quot;Saint-Pierre-et-Miquelon&quot;] &lt;- &quot;Saint Pierre and Miquelon&quot; 
time_series$ctryiso[time_series$Country == &quot;US Virgin Islands&quot;] &lt;- &quot;Virgin Islands, U.S.&quot; 
time_series$ctryiso[time_series$Country == &quot;Wallis and Futuna Islands &quot;] &lt;- &quot;Wallis and Futuna&quot; 
time_series$ctryiso[time_series$Country == &quot;United Kingdom&quot;] &lt;- &quot;United Kingdom of Great Britain and Northern Ireland&quot;

time_series &lt;- merge(x = time_series , by.x = &quot;ctryiso&quot;, all.x = TRUE, y = countrycode , by.y = &quot;official_name_en&quot; )
 

# Population, GDP &amp; GNP per Capita from WorldBank
wb_data &lt;- wb( indicator = c(&quot;SP.POP.TOTL&quot;, &quot;NY.GDP.MKTP.CD&quot;, &quot;NY.GDP.PCAP.CD&quot;, &quot;NY.GNP.PCAP.CD&quot;),
               startdate = 1951, enddate = 2017, return_wide = TRUE)
# Renaming variables for further matching
names(wb_data)[1] &lt;- &quot;ISO3166.1.Alpha.3&quot;
names(wb_data)[2] &lt;- &quot;Year&quot;

## Getting world map for mapping
world &lt;- ne_countries(scale = &quot;small&quot;, returnclass = &quot;sf&quot;)
centroids &lt;- st_transform(world$geometry, &#39;+init=epsg:3857&#39;) %&gt;%  
  ## Reprojected in order to get centroid
  st_centroid() %&gt;% 
  # this is the crs from d, which has no EPSG code:
  st_transform(., &#39;+init=epsg:4326&#39;) %&gt;%
  # since we want the centroids in long lat:
  st_geometry()
world_points &lt;- cbind(world, st_coordinates(centroids))</code></pre>
</div>
</div>
<div id="generate-different-kind-of-plots" class="section level1">
<h1><span class="header-section-number">3</span> Generate different kind of plots</h1>
<div id="line-chart" class="section level2">
<h2><span class="header-section-number">3.1</span> Line chart</h2>
<p>Some key points to consider when designing bar chart are:</p>
<ul>
<li><p>The purpose of the line chart is to show a trend. It is often the best solution when the data presents a time series referring to a single value that changes at regular intervals.</p></li>
<li><p>Choose the y-axis scale appropriately so that we can see the trend. Too flat obscures the message and too exaggerated overstates the trend. The right height is two-thirds of the chart area.</p></li>
<li><p>The weight of the fever line should be thick enough to stand out against the grid line but still thin enough to show the twists and turns of the line. Keep the grid lines thin.</p></li>
<li><p>Unlike a bar chart, a fever line does not necessarily require a zero baseline. Some data trend won’t be discernible starting from zero baseline.</p></li>
<li><p>Avoid labeling at long distance, a legend separated from the line requires the readers to do extra work cross-referencing between the key and the line. Label the lines directly. Direct labeling allows the reader to identify the lines quickly and focus on comparing and contrasting the patterns.</p></li>
<li><p>Use the legend only when the space is tight and the lines intersect extensively. The order of the legend should match the ranking of the end points since they are the most current data points.</p></li>
<li><p>Annotations help to clarify the message.</p></li>
</ul>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code>#Prepare data
line_df &lt;- time_series2 %&gt;%
  filter(Population.type  == &quot;Refugees (incl. refugee-like situations)&quot;) %&gt;%
  group_by(Year) %&gt;%
  summarise(Value2 = sum(Value) ) 


#Make plot
line &lt;- ggplot(line_df, aes(x = Year, y = Value2)) +
  geom_line(colour = &quot;#0072bc&quot;, size = 1) + # Here we mention that it will be a line chart
 # geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
  unhcr_style() + ## Insert UNHCR Style
  scale_y_continuous(label = format_si()) + ## Format axis number
  ## and the chart labels
  labs(title = &quot;More and More refugees&quot;,
       subtitle = &quot;World wide refugee population 1951-2017&quot;, 
       caption = &quot;UNHCR http://popstats.unhcr.org&quot;)</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="multiple-line-chart" class="section level2">
<h2><span class="header-section-number">3.2</span> Multiple line chart</h2>
<p>Some additional points to consider when designing a multiple line chart;</p>
<ul>
<li><p>Don’t use dashed lines and shape markers to differentiate each line! You can use solid lines exclusively by limiting the chart to four or fewer lines. Varying weights and shades do the work of differentiating the lines more effectively than distracting patterns and markers.</p></li>
<li><p>In a single chart, keep the maximum number of lines to three or possibly four if the lines are not intersecting at many points. The purpose of a multiple-line chart is to compare and contrast different data series.</p></li>
<li><p>The most important line should be one color and the other lines should be shades of second colors.</p></li>
</ul>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code>#Prepare data
multiple_line_df &lt;- time_series %&gt;%
  filter(Population.type  == &quot;Refugees (incl. refugee-like situations)&quot; &amp; !(is.na(Region.Name))) %&gt;%
  group_by(Year, Region.Name ) %&gt;%
  summarise(Value2 = sum(Value) ) 

#Make plot
multiple_line &lt;- ggplot(multiple_line_df, aes(x = Year, y = Value2, 
                                              colour = Region.Name)) + # Adding reference to color
  geom_line(size = 1) + # Here we mention that it will be a line chart
  geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
  scale_y_continuous( label = format_si()) + ## Format axis number
  scale_colour_viridis_d() + ## Add color for each lines based on color-blind friendly palette
  unhcr_style() + ## Insert UNHCR Style
  ## and the chart labels
  labs(title = &quot;Refugees Population are not equally spread&quot;,
       subtitle = &quot;World wide refugee population 1951-2017&quot;, 
       caption = &quot;UNHCR http://popstats.unhcr.org&quot;)</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="bar-chart" class="section level2">
<h2><span class="header-section-number">3.3</span> Bar chart</h2>
<p>Some key points to consider when designing bar chart are:</p>
<ul>
<li><p>Start at the zero baseline! No exception. Do not clip the axis in order to highlight disparities at the top of the axis. Instead, try recalculating your data as percentages, or try another type of chart;</p></li>
<li><p>Ensure numerical axis labels are aligned to the decimal point;</p></li>
<li><p>Clearly denote currency or units;</p></li>
<li><p>When axis lines are present, it is not necessary to label each data value. However, it can be useful to highlight the final value or other important data points.</p></li>
<li><p>Convert your data to rounded, easily digestible values for chart labeling</p></li>
<li><p>Omit axes and baselines when data values are labeled, simpler, better!</p></li>
<li><p>When the range of your data crosses natural numerical milestones, such as from millions to billions, set the entire chart in the larger milestone. A chart should never reflect more than 1,000 millions. etc.</p></li>
<li><p>Ensure labels fit neatly under the bars in no more than two lines.</p></li>
<li><p>Horizontal bar charts help compare long lists of values or categories. It has the advantage of printing long labels without using two lines or printing vertical text, as would be required for a vertical bar.</p></li>
<li><p>Remember to sort your data before charting so that readers can easily compare.</p></li>
<li><p>Labeled values eliminate the need for grid lines, while rounding is done to make the values easy to digest.</p></li>
<li><p>Don’t use 3D effect!</p></li>
</ul>
<p>Note that by default, R will display your data in alphabetical order, but arranging it by size instead is simple: just wrap <code>reorder()</code> around the <code>x</code> or <code>y</code> variable you want to rearrange, and specify which variable you want to reorder it by.</p>
<p>E.g. <code>x = reorder(Country, Value2)</code>. Ascending order is the default, but you can change it to descending by wrapping <code>desc()</code> around the variable you’re ordering by.</p>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code>#Prepare data
bar_df &lt;- time_series %&gt;%
  filter(Population.type  == &quot;Refugees (incl. refugee-like situations)&quot; &amp; Year == 2016) %&gt;%
  group_by( Country, Sub.region.Name) %&gt;%
  summarise(Value2 = sum(Value) )  %&gt;%
  arrange(desc(Value2)) %&gt;%
  head(10)

#Make plot
bars &lt;- ggplot(bar_df, aes(x = reorder(Country, Value2), ## Reordering country by Value
                           y = Value2)) +
  geom_bar(stat = &quot;identity&quot;, 
           position = &quot;identity&quot;, 
           fill = &quot;#0072bc&quot;) + # here we configure that it will be bar chart
  geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
  coord_flip() + # Add `coord_flip()` to make your vertical bars horizontal:
  unhcr_style() + ## Insert UNHCR Style
  ## and the chart labels
  labs(title = &quot;Turkey is by the far the biggest Refugee hosting country&quot;,
       subtitle = &quot;Top 10 Refugee Population per country in 2017&quot;, 
       caption = &quot;UNHCR http://popstats.unhcr.org&quot;) +
  scale_y_continuous( label = format_si()) + ## Format axis number
  theme(panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
        panel.grid.major.y = element_blank()) ### changing grid line that should appear</code></pre>
<p>Generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="stacked-bar-chart" class="section level2">
<h2><span class="header-section-number">3.4</span> Stacked bar chart</h2>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code>#prepare data
df1 &lt;- time_series %&gt;%
  filter(Population.type  == &quot;Refugees (incl. refugee-like situations)&quot; &amp; Year == 2016 &amp; !(is.na(Region.Name))) %&gt;%
  group_by(Year, Country, ISO3166.1.Alpha.3 ) %&gt;%
  summarise(Value2 = sum(Value) )

df2 &lt;- merge(x = df1, y = wb_data, by = c(&quot;ISO3166.1.Alpha.3&quot; ,&quot;Year&quot;), all.x = TRUE)
df2 &lt;- merge(x = df2, y = countrycode[ ,c(&quot;ISO3166.1.Alpha.3&quot;, &quot;Region.Name&quot;)], by = &quot;ISO3166.1.Alpha.3&quot; , all.x = TRUE)
df2 &lt;- df2[ !(is.na(df2$Region.Name)) &amp; !(is.na(df2$NY.GNP.PCAP.CD)) , ]
df2$prop &lt;- df2$Value2 / df2$SP.POP.TOTL

stacked_df1 &lt;- df2 %&gt;%
  mutate(CountryClass = cut(NY.GNP.PCAP.CD, 
                              breaks = c(0, 1005, 3955, 12235, 150000),
                              labels = c(&quot;Low-income&quot;, &quot;Lower-middle income&quot;, &quot;Upper-middle income&quot;, &quot;High-income&quot;))) %&gt;%
  group_by(Region.Name, CountryClass) %&gt;%
  summarise(Value3 = sum(as.numeric(Value2)))

#create plot
stacked_bars &lt;- ggplot(data = stacked_df1, 
                     aes(x = Region.Name,
                         y = Value3,
                         fill = CountryClass)) +
                geom_bar(stat = &quot;identity&quot;, 
                         position = &quot;fill&quot;) +
                unhcr_style() +
                scale_y_continuous(labels = scales::percent) +
                scale_fill_viridis_d(direction = -1) +
                geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
                labs(title = &quot;High Share of Refugees in Africa are hosted in low-income countries&quot;,
                     subtitle = &quot;% of population by Country classification per Region, 2017&quot;, 
                     caption = &quot;UNHCR http://popstats.unhcr.org - World Bank&quot;) +
                theme(legend.position = &quot;top&quot;, 
                      legend.justification = &quot;left&quot;) +
                guides(fill = guide_legend(reverse = TRUE))</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>This example shows proportions, but you might want to make a stacked bar chart showing number values instead - this is easy to change!</p>
<p>The value passed to the <code>position</code> argument will determine if your stacked chart shows proportions or actual values.</p>
<p><code>position = &quot;fill&quot;</code> will draw your stacks as proportions, and <code>position = &quot;identity&quot;</code> will draw number values.</p>
</div>
<div id="grouped-bar-chart" class="section level2">
<h2><span class="header-section-number">3.5</span> Grouped bar chart</h2>
<p>Making a grouped bar chart is very similar to making a bar chart.</p>
<p>You just need to change <code>position = &quot;identity&quot;</code> to <code>position = &quot;dodge&quot;</code>, and set the <code>fill</code> aesthetically instead:</p>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code>#Prepare data
grouped_bar_df &lt;- time_series %&gt;%
    filter(Population.type  == &quot;Refugees (incl. refugee-like situations)&quot;)  %&gt;%
    filter(Year == 2006 | Year == 2016) %&gt;%
    group_by( Country, Year) %&gt;%
    summarise(Value2 = sum(Value) )  %&gt;%
    select(Country, Year, Value2) %&gt;%
    spread(Year, Value2) %&gt;%
    mutate(gap = `2016` - `2006`) %&gt;%
    arrange(desc(gap)) %&gt;%
    head(10) %&gt;%
    gather(key = Year, 
           value = Value2,
           -Country,
           -gap) 
  
#Make plot
grouped_bars &lt;- ggplot(grouped_bar_df, 
                       aes(x = Country, 
                           y = Value2, 
                           fill = as.factor(Year))) +
  
  coord_flip() +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
  unhcr_style() +
  scale_fill_manual(values = c(&quot;#0072bc&quot;, &quot;#FAAB18&quot;)) +
  labs(title = &quot;Biggest Increase Population&quot;,
       subtitle = &quot;10 Biggest change in Refugee Population, 2006-2016&quot;, 
       caption = &quot;UNHCR http://popstats.unhcr.org&quot;) +
  scale_y_continuous( label = format_si()) + ## Format axis number
  theme(panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
        panel.grid.major.y = element_blank()) ### changing grid line that should appear</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="dumbbell-chart" class="section level2">
<h2><span class="header-section-number">3.6</span> Dumbbell chart</h2>
<p>Dumbbell plot (also known as Dumbbell chart, Connected dot plot) is great for displaying changes between two points in time, two conditions or differences between two groups.
Another way of showing difference is a dumbbell chart:</p>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code>library(&quot;ggalt&quot;)
library(&quot;tidyr&quot;)

#Prepare data
dumbbell_df &lt;- time_series %&gt;%
    filter(Population.type  == &quot;Refugees (incl. refugee-like situations)&quot;)  %&gt;%
    filter(Year == 2006 | Year == 2016) %&gt;%
    group_by( ctryiso, Year) %&gt;%
    summarise(Value2 = sum(Value) )  %&gt;%
    select(ctryiso, Year, Value2) %&gt;%
    spread(Year, Value2) %&gt;%
    mutate(gap = `2006` - `2016`) %&gt;%
    arrange(desc(gap)) %&gt;%
    head(10) 

# Make plot
dumbell &lt;- ggplot(dumbbell_df, aes(x = `2006`, xend = `2016`,
                                   y = reorder(ctryiso, gap),
                                   group = ctryiso)) + 
  geom_dumbbell(colour = &quot;#dddddd&quot;,
                size = 3,
                colour_x = &quot;#0072bc&quot;,
                colour_xend = &quot;#FAAB18&quot;) +
  unhcr_style() + 
  labs(title = &quot;Where did Refugee Population decreased in the past 10 years?&quot;,
       subtitle = &quot;Biggest decrease in Refugee Population, 2006-2016&quot;, 
       caption = &quot;UNHCR http://popstats.unhcr.org&quot;) +
  scale_x_continuous( label = format_si()) + ## Format axis number
  theme(panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
        panel.grid.major.y = element_blank()) ### changing grid line that should appear</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="histogram" class="section level2">
<h2><span class="header-section-number">3.7</span> Histogram</h2>
<p>Histogram are used to plot the frequency of score occurrences in a continuous variable (numeric, integer) that has been divided into classes, called bins.</p>
<p>A histogram is <strong>not</strong> a bar chart: histograms are used to show distributions (or the shape) of variables while bar charts are used to compare variables.</p>
<p>Some data sets have a distinct shape. Data hardly ever fall into perfect patterns, so you have to decide whether the data shape. The two interpretation key are the following:</p>
<ul>
<li><p>Symmetric bell shape: if you cut it down the middle and the left-hand and right-hand sides resemble mirror images of each other. The middle of the chart is the place when the largest occurrence appears: in this case, we have something closed to a normal distribution. <strong>Kurtosis</strong> is a measure of whether the data are heavy-tailed or light-tailed relative to a normal distribution. That is, data sets with high kurtosis tend to have heavy tails, or outliers. Data sets with low kurtosis tend to have light tails, or lack of outliers.</p></li>
<li><p>Skewed right or left:looks like a lopsided mound, with a tail going off to the right or left. <strong>Skewness</strong> is a measure of symmetry, or more precisely, the lack of symmetry. A distribution, or data set, is symmetric if it looks the same to the left and right of the center point.</p></li>
</ul>
<p>A uniform distribution would be the extreme case.</p>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code># Prepare Data
 hist_df &lt;-  df2 %&gt;%
    mutate(ref.per.local = (Value2 / SP.POP.TOTL) * 100) %&gt;%
    arrange(desc(Value2)) %&gt;%
    head(50)
  
# Chart
histo &lt;-  ggplot(hist_df, aes(ref.per.local)) +
    geom_histogram( colour = &quot;white&quot;, fill = &quot;#0072bc&quot;) +
    geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
    unhcr_style() +
    scale_x_continuous(limits = c(0, 20)) +
    labs(ylab = &quot;Count of countries&quot;,
         title = &quot;Only 2 countries have more than 5 refugees per 100 locals&quot;,
         subtitle = &quot;Distribution of refugee to local ratio for top 50 refugee hosting countries  in 2016&quot;, 
         caption = &quot;UNHCR http://popstats.unhcr.org - World Bank&quot;)</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="scatterplot" class="section level2">
<h2><span class="header-section-number">3.8</span> Scatterplot</h2>
<p>Scatter plot are used to check for correlation. A trend line can be added to compare two set of measures to determine if as one set goes up, the other set correspondingly goes up or down and how strongly.</p>
<p>Scatter plot are also a good way to identify clusters of observation.</p>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code>## Chart
scatter &lt;- ggplot(df2, aes(y = Value2, x = NY.GDP.MKTP.CD)) + 
  geom_point(aes(col = Region.Name)) + 
  #geom_smooth(method = &quot;loess&quot;, se = F) + 
  unhcr_style() +
  scale_x_continuous( label = format_si(), ) + ## Format axis number
  scale_y_continuous( label = format_si(), 
                      limits = c(0, 1000000)) + ## Format axis number
  scale_color_viridis_d(direction = -1) +
  labs(title = &quot;Refugee hosting is not correlated with Economic Wealth&quot;, 
       subtitle = &quot;Refugee population Vs GDP&quot;, 
       y = &quot;Refugee&quot;, 
       x = &quot;Gross domestic product (GDP)&quot;, 
       caption = &quot;2016 Figures, UNHCR http://popstats.unhcr.org, World bank&quot;) +
  theme(axis.title = element_text(size = 12))</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="maps" class="section level2">
<h2><span class="header-section-number">3.9</span> Maps</h2>
<p>A map is a graphic representation or scale model of spatial concepts. It is a means for conveying geographic information. Maps are a universal medium for communication, easily understood and appreciated by most people, regardless of language or culture. Maps are not realistic representations of the actual world. All maps are estimations, generalizations, and interpretations of true geographic conditions.</p>
<p>One key rule when creating a map is:</p>
<ol style="list-style-type: decimal">
<li>Absolute value: Proportional symbol</li>
<li>Relative value (ratio): Choropleth</li>
</ol>
<p><strong>Let’s see what code is required for such chart: </strong></p>
<pre class="r"><code># Merge data with geographic coordinates
world &lt;- merge(x = world , y = df2, by.y = &quot;ISO3166.1.Alpha.3&quot; , by.x = &quot;iso_a3&quot;)
df3 &lt;- merge(x = df2 , y = world_points, by.x = &quot;ISO3166.1.Alpha.3&quot; , by.y = &quot;iso_a3&quot;)


# plot
map &lt;- ggplot(data = world) + 
  geom_sf(fill = &quot;antiquewhite&quot;, colour = &quot;#7f7f7f&quot;, size = 0.2) + 
  coord_sf(xlim = c(-25, 65), ylim = c(25, 75), expand = FALSE) + ## Clipping on Mediterranean Sea
  geom_point(data = df3, aes(x = X, y = Y , size = Value2 ), 
             alpha = 0.6, colour = &quot;red&quot;) +
  scale_size_area( max_size = 20) +
  xlab(&quot;&quot;) +
  ylab(&quot;&quot;) + 
  ggtitle(&quot;Refugee Distribution&quot;) + 
  unhcr_style() +
  theme(panel.grid.major = element_line(color = gray(.5), 
                                        linetype = &quot;dashed&quot;, size = 0.5),
        panel.background = element_rect(fill = &quot;aliceblue&quot;),
        axis.text.x  = element_blank(),
        axis.text.y  = element_blank(),
        legend.position = &quot;none&quot;
        )</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="work-with-small-multiples" class="section level1">
<h1><span class="header-section-number">4</span> Work with small multiples</h1>
<p>Small multiple charts are easy to create with ggplot: it’s called faceting.</p>
<div id="facets" class="section level2">
<h2><span class="header-section-number">4.1</span> Facets</h2>
<ul>
<li>With four or more data series, an array of individual charts can display a pattern and allows better comparison among all lines.</li>
</ul>
<p>If you have data that you want to visualize split up by some variable, you need to use <code>facet_wrap</code> or <code>facet_grid</code>.</p>
<p>Add the variable you want to divide by to this line of code: <code>facet_wrap( ~ variable)</code>.</p>
<p>An additional argument to facet wrap, <code>ncol</code>, allows you to specify the number of columns:</p>
<pre class="r"><code>#Prepare data
facet &lt;- time_series %&gt;%
    filter(Population.type  == &quot;Refugees (incl. refugee-like situations)&quot; &amp; !(is.na(Region.Name))) %&gt;%
    group_by(Year, Region.Name ) %&gt;%
    summarise(Value2 = sum(Value) ) 

#Make plot
facet_plot &lt;- ggplot() +
  geom_area(data = facet, aes(x = Year, y = Value2, fill = Region.Name)) +
  scale_colour_viridis_d() + ## Add color for each lines based on color-blind friendly palette
  facet_wrap( ~ Region.Name, ncol = 5) + 
  scale_y_continuous(labels = format_si()) +
  unhcr_style() +
  geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
  theme(legend.position = &quot;none&quot;,
        axis.text.x = element_blank()) +
  labs(title = &quot;Africa &amp; Asia are hosting the biggest Refugee population&quot;,
       subtitle = &quot;Refugee Population growth by continent, 1951-2016&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="free-scales" class="section level2">
<h2><span class="header-section-number">4.2</span> Free scales</h2>
<p>You may have noticed in the chart above that Oceania, with its relatively small population, has disappeared completely.</p>
<p>By default, faceting uses fixed axis scales across the small multiples. It’s always best to use the same y axis scale across small multiples, to avoid misleading, but sometimes you may need to set these independently for each multiple, which we can do by adding the argument <code>scales = &quot;free&quot;</code>.</p>
<p>If you just want to free the scales for one axis set the argument to <code>free_x</code> or <code>free_y</code>.</p>
<pre class="r"><code>#Make plot
facet_plot_free &lt;- ggplot() +
  geom_area(data = facet, aes(x = Year, y = Value2, fill = Region.Name)) +
  facet_wrap(~ Region.Name, scales = &quot;free&quot;) + 
  unhcr_style() +
  scale_colour_viridis_d() + ## Add color for each lines based on color-blind friendly palette
  geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
  theme(legend.position = &quot;none&quot;,
        axis.text.x = element_blank(),
        axis.text.y = element_blank()) +
  labs(title = &quot;It&#39;s all relative&quot;,
       subtitle = &quot;Refugee Population growth by continent, 1951-2016&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
</div>
<div id="make-changes-to-the-legend" class="section level1">
<h1><span class="header-section-number">5</span> Make changes to the legend</h1>
<div id="remove-the-legend" class="section level2">
<h2><span class="header-section-number">5.1</span> Remove the legend</h2>
<p>Remove the legend to become one - it’s better to label data directly with text annotations.</p>
<p>Use <code>guides(colour=FALSE)</code> to remove the legend for a specific aesthetic (replace <code>colour</code> with the relevant aesthetic).</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + guides(colour = FALSE)</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>You can also remove all legends in one go using <code>theme(legend.position = &quot;none&quot;)</code>:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + theme(legend.position = &quot;none&quot;)</code></pre>
</div>
<div id="change-the-position-of-the-legend" class="section level2">
<h2><span class="header-section-number">5.2</span> Change the position of the legend</h2>
<p>The legend’s default position is at the top of your plot. Move it to the left, right or bottom outside the plot with:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + theme(legend.position = &quot;bottom&quot;)</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>To be really precise about where we want our legend to go, instead of specifying “right” or “top” to change the general position of where the legend appears in our chart, we can give it specific coordinates.</p>
<p>For example <code>legend.position=c(0.98,0.1)</code> will move the legend to the bottom right. For reference, c(0,0) is bottom left, c(1,0) is bottom right, c(0,1) is top left and so on). Finding the exact position may involve some trial and error.</p>
<p>To check the exact position where the legend appears in your finalized plot you will have to check the file that is saved out after you run your <code>finalise_plot()</code> function, as the position will be relevant to the dimensions of the plot.</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + 
                  theme(legend.position = c(0.1,0.5),
                      legend.direction = &quot;vertical&quot;) +  
                  labs(title = &quot;Refugees Population are not equally spread&quot;,
                       subtitle = &quot;World wide refugee population 1951-2017&quot;, 
                       caption = &quot;UNHCR http://popstats.unhcr.org&quot;)</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>To get the legend flush against the left side of your chart, it may be easier to set a negative left margin for the legend using <code>legend.margin</code>. The syntax is <code>margin(top, right, bottom, left)</code>.</p>
<p>You’ll have to experiment to find the correct number to set the margin to for your chart - save it out with <code>finalise_plot()</code> and see how it looks.</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line +
                 theme(legend.margin = margin(0, 0, 0, -200))</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="remove-the-legend-title" class="section level2">
<h2><span class="header-section-number">5.3</span> Remove the legend title</h2>
<p>Remove the legend title by tweaking your <code>theme()</code>. Don’t forget that for any changes to the theme to work, they must be added after you’ve called <code>unhcr_style()</code>!</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line +
                 theme(legend.title = element_blank())</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
<div id="reverse-the-order-of-your-legend" class="section level2">
<h2><span class="header-section-number">5.4</span> Reverse the order of your legend</h2>
<p>Sometimes you need to change the order of your legend for it to match the order of your bars. For this, you need <code>guides</code>:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line +
                 guides(fill = guide_legend(reverse = TRUE))</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="rearrange-the-layout-of-your-legend" class="section level2">
<h2><span class="header-section-number">5.5</span> Rearrange the layout of your legend</h2>
<p>If you’ve got many values in your legend, you may need to rearrange the layout for aesthetic reasons.</p>
<p>You can specify the number of rows you want your legend to have as an argument to <code>guides</code>. The below code snippet, for instance, will create a legend with 2 rows:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line +
                 theme(legend.direction = &quot;horizontal&quot;) +
                 guides(fill = guide_legend(nrow = 2, byrow = T))</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>You may need to change <code>fill</code> in the code above to whatever aesthetic your legend is describing, e.g. <code>size</code>, <code>colour</code>, etc.</p>
</div>
<div id="change-the-appearance-of-your-legend-symbols" class="section level2">
<h2><span class="header-section-number">5.6</span> Change the appearance of your legend symbols</h2>
<p>You can override the default appearance of the legend symbols, without changing the way they appear in the plot, by adding the argument <code>override.aes</code> to <code>guides</code>.</p>
<p>The below will make the size of the legend symbols larger, for instance:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line +
                 guides(fill = guide_legend(override.aes = list(size = 2)))</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
</div>
<div id="add-space-between-your-legend-labels" class="section level2">
<h2><span class="header-section-number">5.7</span> Add space between your legend labels</h2>
<p>The default ggplot legend has almost no space between individual legend items. Not ideal.</p>
<p>You can add space by changing the scale labels manually.</p>
<p>For instance, if you have set the color of your geoms to be dependent on your data, you will get a legend for the color, and you can tweak the exact labels to get some extra space in by using the below snippet:</p>
<pre class="r"><code># multiple_line2 &lt;- multiple_line +
#                  scale_colour_manual(labels = function(x) paste0(&quot; &quot;, x))</code></pre>
<p>generate this chart:</p>
<p><img src="index_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>If your legend is showing something different, you will need to change the code accordingly. For instance, for fill, you will need <code>scale_fill_manual()</code> instead.</p>
</div>
</div>
<div id="make-changes-to-the-axes" class="section level1">
<h1><span class="header-section-number">6</span> Make changes to the axes</h1>
<div id="addremove-gridlines" class="section level2">
<h2><span class="header-section-number">6.1</span> Add/remove gridlines</h2>
<p>The theme only has grid lines: remove the grid lines on the y axis with <code>panel.grid.major.y = element_blank()</code>)</p>
<pre class="r"><code>bars2 &lt;- bars + 
  theme(panel.grid.major.x = element_blank())</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div id="change-the-axis-text-manually" class="section level2">
<h2><span class="header-section-number">6.2</span> Change the axis text manually</h2>
<p>You can change the axis text labels freely with <code>scale_y_continuous</code> or <code>scale_x_continuous</code>:</p>
<pre class="r"><code>bars2 &lt;- bars + scale_y_continuous(limits = c(0, 1000000),
                   breaks = seq(0, 1000000, by = 200000),
                   labels = c(&quot;0&quot;,&quot;200,&quot;, &quot;400,&quot;, &quot;600,&quot;, &quot;800,&quot;, &quot;1M&quot;))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>This will also specify the limits of your plot as well as where you want axis ticks.</p>
</div>
<div id="add-thousand-separators-to-your-axis-labels" class="section level2">
<h2><span class="header-section-number">6.3</span> Add thousand separators to your axis labels</h2>
<p>You can specify that you want your axis text to have thousand separators with an argument to <code>scale_y_continuous</code>.</p>
<p>There are two ways of doing this, one in base R which is a bit fiddly:</p>
<pre class="r"><code>bars2 &lt;- bars + scale_y_continuous(labels = function(x) format(x, big.mark = &quot;,&quot;,
                                                 scientific = FALSE))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>The second way relies on the <code>scales</code> package, but is much more concise:</p>
<pre class="r"><code>bars2 &lt;- bars +  scale_y_continuous(labels = scales::comma)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
</div>
<div id="add-text-to-your-axis-labels" class="section level2">
<h2><span class="header-section-number">6.4</span> Add text to your axis labels</h2>
<p>This is also easy to add with an argument to <code>scale_y_continuous</code>:</p>
<pre class="r"><code>bars2 &lt;- bars +  scale_y_continuous(labels = function(x) paste0(x, &quot; Ref.&quot;))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
</div>
<div id="change-the-plot-limits" class="section level2">
<h2><span class="header-section-number">6.5</span> Change the plot limits</h2>
<p>The long way of setting the limits of your plot explicitly is with <code>scale_y_continuous</code> as above. But if you don’t need to specify the breaks or labels the shorthand way of doing it is with <code>xlim</code> or <code>ylim</code>:</p>
<pre class="r"><code>bars2 &lt;- bars +  ylim(c(0,500000))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
<div id="add-axis-titles" class="section level2">
<h2><span class="header-section-number">6.6</span> Add axis titles</h2>
<p>Our default theme has no axis titles, but you may wish to add them in manually. This is done by modifying <code>theme()</code> - note that you must do this after the call to <code>unhcr_style()</code> or your changes will be overridden:</p>
<pre class="r"><code>bars2 &lt;- bars +
         theme(axis.title = element_text(size = 18))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
</div>
<div id="modify-axis-titles" class="section level2">
<h2><span class="header-section-number">6.7</span> Modify axis titles</h2>
<p>If you add in axis titles, they will by default be the column names in your data set. You can change this to anything you want in your call to <code>labs()</code>.</p>
<p>For instance, if you wish your x axis title to be “I’m an axis” and your y axis label to be blank, this would be the format:</p>
<pre class="r"><code>bars3 &lt;- bars2 +
         labs(x = &quot;Country&quot;,  y = &quot;Population&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
<div id="add-axis-ticks" class="section level2">
<h2><span class="header-section-number">6.8</span> Add axis ticks</h2>
<p>You can add axis tick marks by adding <code>axis.ticks.x</code> or <code>axis.ticks.y</code> to your <code>theme</code>:</p>
<pre class="r"><code>multiple_line2  &lt;- multiple_line + 
                  theme(
                    axis.ticks.x = element_line(colour = &quot;#333333&quot;), 
                    axis.ticks.length =  unit(0.26, &quot;cm&quot;))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
</div>
</div>
<div id="add-annotations" class="section level1">
<h1><span class="header-section-number">7</span> Add annotations</h1>
<div id="insert-text-within-chart" class="section level2">
<h2><span class="header-section-number">7.1</span> Insert text within chart</h2>
<p>The easiest way to add a text annotation to your plot is using <code>geom_label</code>:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + 
                 geom_label(aes(x = 1990, y = 5000000, label = &quot;I&#39;m an annotation!&quot;), 
                           hjust = 0, 
                           vjust = 0.5, 
                           colour = &quot;#555555&quot;, 
                           fill = &quot;white&quot;, 
                           label.size = NA, 
                           family = &quot;Lato&quot;, 
                           size = 6)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<p>The exact positioning of the annotation will depend on the <code>x</code> and <code>y</code> arguments (which is a bit fiddly!) and the text alignment, using <code>hjust</code> and <code>vjust</code> - but more on that below.</p>
<p>Add line breaks where necessary in your label with <code>\n</code>, and set the line height with <code>lineheight</code>.</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + 
  geom_label(aes(x = 1990, y = 5000000, 
                 label = &quot;I&#39;m quite a long\nannotation over\nthree rows&quot;), 
             hjust = 0, 
             vjust = 0.5, 
             lineheight = 0.8,
             colour = &quot;#555555&quot;, 
             fill = &quot;white&quot;, 
             label.size = NA, 
             family = &quot;Lato&quot;, 
             size = 6) </code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>Let’s get our direct labels in there!</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + 
                  theme(legend.position = &quot;none&quot;) + 
                  xlim(c(1950, 2028)) +
                  geom_label(aes(x = 2017, y = 5531693, label = &quot;Africa&quot;), 
                             hjust = 0, 
                             vjust = 0.5, 
                             colour = &quot;Black&quot;,  
                             fill = &quot;white&quot;, 
                             label.size = NA, 
                             family = &quot;Lato&quot;, 
                             size = 6) +
                  geom_label(aes(x = 2017, y = 693600, label = &quot;America&quot;), 
                             hjust = 0, 
                             vjust = 0.5,
                             colour = &quot;Black&quot;,   
                             fill = &quot;white&quot;, 
                             label.size = NA, 
                             family = &quot;Lato&quot;, 
                             size = 6) +
                  geom_label(aes(x = 2017, y = 8608597, label = &quot;Asia&quot;), 
                             hjust = 0, 
                             vjust = 0.5, 
                             colour = &quot;Black&quot;,  
                             fill = &quot;white&quot;, 
                             label.size = NA, 
                             family = &quot;Lato&quot;, 
                             size = 6) +
                  geom_label(aes(x = 2017, y = 2300833, label = &quot;Europe&quot;), 
                             hjust = 0, 
                             vjust = 0.5, 
                             colour = &quot;Black&quot;,  
                             fill = &quot;white&quot;, 
                             label.size = NA, 
                             family = &quot;Lato&quot;, 
                             size = 6) +
                  geom_label(aes(x = 2017, y = 53671, label = &quot;Oceania&quot;), 
                             hjust = 0, 
                             vjust = 0.5,  
                             colour = &quot;Black&quot;, 
                             fill = &quot;white&quot;, 
                             label.size = NA, 
                             family = &quot;Lato&quot;, 
                             size = 6) </code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
</div>
<div id="left-alignright-align-text" class="section level2">
<h2><span class="header-section-number">7.2</span> Left-align/right-align text</h2>
<p>The arguments <code>hjust</code> and <code>vjust</code> dictate horizontal and vertical text alignment. They can have a value between 0 and 1, where 0 is left-justified and 1 is right-justified (or bottom- and top-justified for vertical alignment).</p>
</div>
<div id="add-labels-based-on-your-data" class="section level2">
<h2><span class="header-section-number">7.3</span> Add labels based on your data</h2>
<p>The above method for adding annotations to your chart lets you specify the x and y coordinates exactly. This is very useful if we want to add a text annotation in a specific place, but would be very tedious to repeat.</p>
<p>Fortunately, if you want to add labels to all your data points, you can simply set the position based on your data instead.</p>
<p>Let’s say we want to add data labels to our bar chart:</p>
<pre class="r"><code>labelled.bars &lt;- bars +
  geom_label(aes(x = Country, y = Value2, label = round(Value2, 0)),
             hjust = 1, 
             vjust = 0.5, 
             colour = &quot;white&quot;, 
             fill = NA, 
             label.size = NA, 
             family = &quot;Lato&quot;, 
             size = 6)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
<p>The above code automatically adds one text label for each continent, without us having to add <code>geom_label</code> five separate times.</p>
<p>(If you’re confused about why we’re setting the <code>x</code> as the continents and <code>y</code> as life expectancy, when the chart appears to be drawing them the other way around, it’s because we’ve flipped the coordinates of the plot using <code>coord_flip()</code>, which you can <a href="https://github.com/bbc/vjdata.rcookbook#flip-the-coordinates-of-a-plot">read more about here</a>.)</p>
</div>
<div id="add-left-aligned-labels-to-bar-charts" class="section level2">
<h2><span class="header-section-number">7.4</span> Add left-aligned labels to bar charts</h2>
<p>If you’d rather add left-aligned labels for your bars, just set the <code>x</code> argument based on your data, but specify the <code>y</code> argument directly instead, with a numeric value.</p>
<p>The exact value of <code>y</code> will depend on the range of your data.</p>
<pre class="r"><code>labelled.bars.v2 &lt;- bars +
  geom_label(aes(x = Country, 
                 y = 4, 
                 label = round(Value2, 0)),
             hjust = 0, 
             vjust = 0.5, 
             colour = &quot;white&quot;, 
             fill = NA, 
             label.size = NA, 
             family = &quot;Lato&quot;, 
             size = 6)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
</div>
<div id="add-a-line" class="section level2">
<h2><span class="header-section-number">7.5</span> Add a line</h2>
<p>Add a line with <code>geom_segment</code>:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + 
                  geom_segment(aes(x = 1979, y = 4500000, xend = 1965, yend = 4300000), 
                             colour = &quot;#555555&quot;, 
                             size = 4)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>The <code>size</code> argument specifies the thickness of the line.</p>
</div>
<div id="add-a-curved-line" class="section level2">
<h2><span class="header-section-number">7.6</span> Add a curved line</h2>
<p>For a curved line, use <code>geom_curve</code> instead of <code>geom_segment</code>:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + geom_curve(aes(x = 1979, y = 4500000, xend = 1965, yend = 4300000), 
                           colour = &quot;#555555&quot;, 
                           curvature = -0.2,
                           size = 0.5)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>The <code>curvature</code> argument sets the amount of curve: 0 is a straight line, negative values give a left-hand curve and positive values give a right-hand curve.</p>
</div>
<div id="add-an-arrow" class="section level2">
<h2><span class="header-section-number">7.7</span> Add an arrow</h2>
<p>Turning a line into an arrow is fairly straightforward: just add the <code>arrow</code> argument to your <code>geom_segment</code> or <code>geom_curve</code>:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + geom_curve(aes(x = 1979, y = 4500000, xend = 1965, yend = 4300000), 
                             colour = &quot;#555555&quot;, 
                             size = 0.5, 
                             curvature = -0.2,
                             arrow = arrow(length = unit(0.03, &quot;npc&quot;)))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>The first argument to <code>unit</code> sets the size of the arrowhead.</p>
</div>
<div id="add-a-line-across-the-whole-plot" class="section level2">
<h2><span class="header-section-number">7.8</span> Add a line across the whole plot</h2>
<p>The easiest way to add a line across the whole plot is with <code>geom_vline()</code>, for a vertical line, or <code>geom_hline()</code>, for a horizontal one.</p>
<p>Optional additional arguments allow you to specify the size, color and type of line (the default option is a solid one).</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + 
                  geom_hline(yintercept = 10000000, size = 1, colour = &quot;red&quot;, linetype = &quot;dashed&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>The line obviously doesn’t add much in this example, but this is useful if you want to highlight something, e.g. a threshold level, or an average value.</p>
<p>It’s also especially useful because our design style - as you may already have noticed from the charts on this page - is to add a vertical or horizontal baseline to our charts. This is the code to use:</p>
<pre class="r"><code>multiple_line2 &lt;- multiple_line + 
                  geom_hline(yintercept = 8000000, size = 1, colour = &quot;#333333&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
</div>
</div>
<div id="do-something-else-entirely" class="section level1">
<h1><span class="header-section-number">8</span> Do something else entirely</h1>
<div id="increase-or-decrease-margins" class="section level2">
<h2><span class="header-section-number">8.1</span> Increase or decrease margins</h2>
<p>You can change the margin around almost any element of your plot - the title, subtitles, legend - or the plot itself.</p>
<p>You shouldn’t ordinarily need to change the default margins from the theme but if you do, the syntax is <code>theme(ELEMENT=element_text(margin=margin(0, 5, 10, 0)))</code>.</p>
<p>The numbers specify the top, right, bottom, and left margin respectively - but you can also specify directly which margin you want to change. For example, let’s try giving the subtitle an extra-large bottom margin:</p>
<pre class="r"><code>bars2 &lt;- bars + 
          theme(plot.subtitle = element_text(margin = margin(b = 75)))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>Hm… maybe not.</p>
</div>
<div id="exporting-your-plot-and-x-axis-margins" class="section level2">
<h2><span class="header-section-number">8.2</span> Exporting your plot and x-axis margins</h2>
<p>You do need to think about your x-axis margin sizes when you are producing a plot that is beyond the default height, which is 450px. This could be the case for example if you are creating a bar chart with lots of bars and want to make sure there is some breathing space between each bar and labels. If you do leave the margins as they are for plots with a greater height, then you could get a larger gap between the axis and your labels.</p>
<p>Here is a guide that we work to when it comes to the margins and the height of your bar chart (with coord_flip applied to it):</p>
<table>
<thead>
<tr class="header">
<th align="center">size</th>
<th align="center">t</th>
<th align="center">b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">550px</td>
<td align="center">5</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">650px</td>
<td align="center">7</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">750px</td>
<td align="center">10</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">850px</td>
<td align="center">14</td>
<td align="center">10</td>
</tr>
</tbody>
</table>
<p>So what you’d need to do is add this code to your chart if for example you wanted the height of your plot to be 650px instead of 450px.</p>
<pre class="r"><code>bar_chart_tall &lt;- bars + 
                  theme(axis.text.x = element_text(margin = margin(t = 14, b = 10)))
#bar_chart_tall</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>Although it is much less likely, but if you do want to do the equivalent for a line chart and export it at a larger than default height, you need to do the same but change your values for t to negative values based on the table above.</p>
</div>
<div id="reorder-bars-manually" class="section level2">
<h2><span class="header-section-number">8.3</span> Reorder bars manually</h2>
<p>Sometimes you need to order your data in a way that isn’t alphabetical or reordered by size.</p>
<p>To order these correctly you need to set your data’s factor levels before making the plot.</p>
<p>Specify the order you want the categories to be plotted in the <code>levels</code> argument:</p>
<pre class="r"><code>dataset$column &lt;- factor(dataset$column, levels = c(&quot;18-24&quot;,&quot;25-64&quot;,&quot;65+&quot;))</code></pre>
<p>You can also use this to reorder the stacks of a stacked bar chart.</p>
</div>
<div id="colour-bars-conditionally" class="section level2">
<h2><span class="header-section-number">8.4</span> Colour bars conditionally</h2>
<p>You can set aesthetic values like fill, alpha, size conditionally with <code>ifelse()</code>.</p>
<p>The syntax is <code>fill = ifelse(logical_condition, fill_if_true, fill_if_false)</code>.</p>
<pre class="r"><code>highlighted &lt;- ggplot(bar_df, 
                      aes(x = reorder(Country, Value2), y = Value2)) +
              geom_bar(stat = &quot;identity&quot;, position = &quot;identity&quot;, 
                       fill = ifelse(bar_df$Country == &quot;Turkey&quot;, &quot;#0072bc&quot;, &quot;#CCCCCC&quot;)) +
              geom_hline(yintercept = 0, size = 1, colour = &quot;#333333&quot;) +
              unhcr_style() +
              coord_flip() +
              scale_y_continuous(label = format_si()) + ## Format axis number
              labs(title = &quot;Turkey is by the far the biggest Refugee hosting country&quot;,
                   subtitle = &quot;Top 10 Refugee Population per country in 2017&quot;) +
              theme(panel.grid.major.x = element_line(color = &quot;#cbcbcb&quot;), 
                    panel.grid.major.y = element_blank()) </code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1><span class="header-section-number">9</span> Conclusion</h1>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
</div>



<script>
// when the page is about to reload via servr, remember the scroll position
document.addEventListener('servr:reload', function(e) {
  sessionStorage.setItem('pagedown-scroll', window.scrollY);
});
</script>
</body>
</html>
